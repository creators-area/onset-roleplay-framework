<!DOCTYPE html>
<html lang="en">
    
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Vendor styles -->
        <link rel="stylesheet" href="http://asset/orf_core/vendor/dist/css/material-design-iconic-font.min.css">
        <link rel="stylesheet" href="http://asset/orf_core/vendor/dist/css/animate.min.css">
        <link rel="stylesheet" href="http://asset/orf_core/vendor/dist/css/select2.min.css">
        <link rel="stylesheet" href="http://asset/orf_core/vendor/dist/css/bootstrap-colorpicker.css">
        <link rel="stylesheet" href="http://asset/orf_core/vendor/dist/css/jquery.scrollbar.css">
        <link rel="stylesheet" href="http://asset/orf_core/vendor/dist/css/app.min.css">
        <style>
            body {
                background:none;
                background-color:rgba( 0, 0, 0, 0 );
                overflow: hidden;
            }
        </style>
    </head>

    <body>
        <main class="main">

            <section class="content content--full" style="margin: 0;padding: 0;">
                <div class="content__inner">

                    <div class="card" style="background-color: rgba(0,0,0,0.75);">
                        <div class="card-body">
                            <h4 class="card-title" data-trans="creator_title">CHARACTER CREATOR</h4>
                            <h6 id="test" class="card-subtitle" data-trans="creator_subtitle">Make your own character.</h6>

                            <hr />

                            <div class="row">
                                <div class="col-sm-6">
                                    <h3 class="card-body__title" data-trans="creator_first_name">First name</h3>
                                    <div class="form-group">
                                        <input id="firstname" type="text" class="form-control is-invalid" placeholder="">
                                        <i class="form-group__bar"></i>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <h3 class="card-body__title" data-trans="creator_last_name">Last name</h3>
                                    <div class="form-group">
                                        <input id="lastname" type="text" class="form-control is-invalid" placeholder="">
                                        <i class="form-group__bar"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <h3 class="card-body__title" data-trans="creator_face">Face</h3>
                                    <div class="form-group">
                                        <select id="faces" class="select2" data-minimum-results-for-search="Infinity">
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-sm-8">
                                    <h3 class="card-body__title" data-trans="creator_hair_style">Hair style</h3>
                                    <div class="form-group">
                                        <select id="hairs" class="select2" data-minimum-results-for-search="Infinity">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <h3 class="card-body__title" data-trans="creator_hair_color">Color</h3>
                                    <div class="form-group">
                                        <select id="hair_color" class="select2" data-minimum-results-for-search="Infinity">
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-8">
                                    <h3 class="card-body__title" data-trans="creator_top_style">Top style</h3>
                                    <div class="form-group">
                                        <select id="shirts" class="select2" data-minimum-results-for-search="Infinity">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <h3 class="card-body__title" data-trans="creator_top_color">Color</h3>
                                    <div class="form-group color-picker">
                                        <input id="shirt-color" type="text" class="form-control color-picker__value" value="#03A9F4">
                                        <i class="color-picker__preview" style="background-color: #03A9F4"></i>
                                        <i class="form-group__bar"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-sm-8">
                                    <h3 class="card-body__title" data-trans="creator_pants_style">Pants style</h3>
                                    <div class="form-group">
                                        <select id="pants" class="select2" data-minimum-results-for-search="Infinity">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <h3 class="card-body__title" data-trans="creator_pants_color">Color</h3>
                                    <div class="form-group color-picker">
                                        <input type="text" class="form-control color-picker__value" value="#01060C">
                                        <i class="color-picker__preview" style="background-color: #01060C"></i>
                                        <i class="form-group__bar"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-8">
                                    <h3 class="card-body__title" data-trans="creator_shoes_style">Shoes</h3>
                                    <div class="form-group">
                                        <select id="shoes" class="select2" data-minimum-results-for-search="Infinity">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <h3 class="card-body__title" data-trans="creator_shoes_color">Color</h3>
                                    <div class="form-group color-picker">
                                        <input type="text" class="form-control color-picker__value" value="#B20000">
                                        <i class="color-picker__preview" style="background-color: #B20000"></i>
                                        <i class="form-group__bar"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <button id="back-to-selection" class="btn btn-outline-danger">
                                        <i class="zmdi zmdi-arrow-back"></i>
                                        <span data-trans="creator_back_to_selection">Back to character selection</span>
                                    </button>
                                    <button id="confirm-character" class="btn btn-success btn--icon-text float-right">
                                        <i class="zmdi zmdi-check"></i>
                                        <span data-trans="creator_create_character">Create this character</span>
                                    </button>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </section>
        </main>

        <!-- Vendors -->
        <script src="http://asset/orf_core/vendor/dist/js/jquery.min.js"></script>
        <script src="http://asset/orf_core/vendor/dist/js/popper.min.js"></script>
        <script src="http://asset/orf_core/vendor/dist/js/bootstrap.min.js"></script>
        <script src="http://asset/orf_core/vendor/dist/js/jquery.scrollbar.min.js"></script>
        <script src="http://asset/orf_core/vendor/dist/js/jquery-scrollLock.min.js"></script>

        <script src="http://asset/orf_core/vendor/dist/js/select2.full.min.js"></script>
        <script src="http://asset/orf_core/vendor/dist/js/bootstrap-colorpicker.min.js"></script>
        <script>
            (function(obj) {
                ue.game = {};
                ue.game.callevent = function(name, ...args) {
                    if (typeof(name) !== 'string') return;
                    obj.callevent(name, args.length > 0 ? JSON.stringify(args) : '')
                };
            })(ue.game);
            CallEvent = ue.game.callevent;

            function OnReceiveCustomization( customizations ) {
                customizations = JSON.parse(atob(customizations));

                for (const k in customizations.faces) {
                    $('#faces').append(new Option(k, customizations.faces[k], false, false));
                }

                for (const k in customizations.hairs) {
                    $('#hairs').append(new Option(k, customizations.hairs[k], false, false));
                }

                for (const k in customizations.hair_color) {
                    $('#hair_color').append(new Option(k, k, false, false));
                }

                for (const k in customizations.shirts) {
                    $('#shirts').append(new Option(k, customizations.shirts[k], false, false));
                }

                for (const k in customizations.pants) {
                    $('#pants').append(new Option(k, customizations.pants[k], false, false));
                }

                for (const k in customizations.shoes) {
                    $('#shoes').append(new Option(k, customizations.shoes[k], false, false));
                }
            }

            let ui_identifier = ''
            function SaveUIIdentifier( identifier ) {
                ui_identifier = identifier
                $('[data-trans]').each(function(){
                    const trans =  $(this).attr('data-trans')
                    CallEvent('ORF.GetUITranslation', ui_identifier, trans)
                });
            }

            function OnReceiveTranslations( key, translation ) {
                for (const element of document.querySelectorAll(`[data-trans='${atob(key)}']`)) {
                    element.innerHTML = atob(translation)
                }
            }

            $(window).on("load", function() {
                function formatRGBA( rgba ) {
                    return rgba.substr(5).replace(')', '').split(',');
                }

                function changeClothes() {
                    const faces = $('#faces').val();
                    const hairs = $('#hairs').val();
                    const hair_color = $('#hair_color').val();
                    const shirts = $('#shirts').val();
                    const shirt_color = JSON.stringify(formatRGBA($('#shirt-color').data('color')));
                    const pants = $('#pants').val();
                    const shoes = $('#shoes').val();
                    CallEvent( 'ORF.ChangeClothes', faces, hairs, hair_color, shirts, shirt_color, pants, shoes )
                }

                $("select.select2").select2({
                    dropdownAutoWidth: !0,
                    width: "100%",
                });
                $(".color-picker__value").colorpicker({format:'rgba'});
                $("body").on("change", ".color-picker__value", function() {
                    $(this).closest(".color-picker").find(".color-picker__preview").css("backgroundColor", $(this).val())
                    changeClothes()
                });

                $('.select2').on('select2:select', (e) => {
                    changeClothes()
                });

                $('#firstname').on('input', function() {
                    if($(this).val().length > 0) {
                        $(this).removeClass('is-invalid').addClass('is-valid');
                    } else {
                        $(this).removeClass('is-valid').addClass('is-invalid');
                    }
                });

                $('#lastname').on('input', function() {
                    if($(this).val().length > 0) {
                        $(this).removeClass('is-invalid').addClass('is-valid');
                    } else {
                        $(this).removeClass('is-valid').addClass('is-invalid');
                    }
                });
            });

            $(document).on('click', '#back-to-selection', () => {
                CallEvent( 'ORF.BackToCharacterSelectionMenu' )
            });

            $(document).on('click', '#confirm-character', () => {
                let firstname = $('#firstname').val();
                let lastname = $('#lastname').val();
                if ( lastname.length == 0 || firstname.length == 0) {
                    CallEvent('ORF.InvalidCharacterName')
                    return
                }

                const faces = $('#faces').val();
                const hairs = $('#hairs').val();
                const hair_color = $('#hair_color').val();
                const shirts = $('#shirts').val();
                const shirt_color = JSON.stringify(formatRGBA($('#shirt-color').data('color')));
                const pants = $('#pants').val();
                const shoes = $('#shoes').val();
                CallEvent('ORF.CreateCharacter', firstname, lastname, faces, hairs, hair_color, shirts, shirt_color, pants, shoes )
                $('#confirm-character').addClass('disable')
            });
        </script>
    </body>
</html>
